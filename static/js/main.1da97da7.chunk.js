(this["webpackJsonpsite-video-chat-client"]=this["webpackJsonpsite-video-chat-client"]||[]).push([[0],{207:function(e,t,a){"use strict";a.r(t);var o=a(6),n=a(81),i=a.n(n),c=(a(91),a.p,a(92),a(82)),r=a(83),s=a(10),l=a(85),d=a(84),h=a(33),m=a.n(h),u=a(211),v=a(208),k=a(209),f=a(210),p=a(1),y="video-svc-5346-dev.twil.io",j=a(33).createLocalVideoTrack,g=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(e){var o;return Object(c.a)(this,a),(o=t.call(this,e)).state={worker:"",token:"",identity:"",roomName:"",roomNameErr:!1,previewTracks:null,localMediaAvailable:!1,hasJoinedRoom:!1,activeRoom:null,screenTrack:null,showPreview:!0},o.joinRoom=o.joinRoom.bind(Object(s.a)(o)),o.handleRoomNameChange=o.handleRoomNameChange.bind(Object(s.a)(o)),o.roomJoined=o.roomJoined.bind(Object(s.a)(o)),o.onLeaveRoom=o.onLeaveRoom.bind(Object(s.a)(o)),o.detachParticipantTracks=o.detachParticipantTracks.bind(Object(s.a)(o)),o.attachLocalTracks=o.attachLocalTracks.bind(Object(s.a)(o)),o}return Object(r.a)(a,[{key:"handleRoomNameChange",value:function(e){var t=e.target.value,a=e.target.value;this.setState({identity:t}),this.setState({roomName:a})}},{key:"joinRoom",value:function(){this.state.roomName="Khospace Delray Beach",console.log("Joining room '"+this.state.roomName+"'...");var e={name:this.state.roomName};this.state.previewTracks&&(e.tracks=this.state.previewTracks),m.a.connect(this.state.token,e).then(this.roomJoined,(function(e){alert("Could not connect to Twilio: "+e.message)}))}},{key:"getScreenShare",value:function(){return navigator.getDisplayMedia?navigator.getDisplayMedia({video:!0}):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia({video:!0}):navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"}})}},{key:"attachTracks",value:function(e,t){console.log("Saiful: "+e),e.forEach((function(e){t.appendChild(e.track.attach())}))}},{key:"attachLocalTracks",value:function(e,t){console.log("SaifulL: "+e),Array.isArray(e)&&e.forEach((function(e){var a=e.track.attach();a.style.maxWidth="15%",a.style.position="absolute",a.style.top="20px",a.style.left="50px",a.style.left="0px",a.style.margin="0",t.appendChild(a)}))}},{key:"attachParticipantTracks",value:function(e,t){var a=Array.from(e.tracks.values());this.attachTracks(a,t)}},{key:"detachTracks",value:function(e){e.forEach((function(e){e.detach().forEach((function(e){e.remove()}))}))}},{key:"detachParticipantTracks",value:function(e){var t=Array.from(e.tracks.values()),a=this.refs.remoteMedia;a.querySelector("video")||this.detachParticipantTracks({tracks:t},a)}},{key:"onCreateTask",value:function(e,t,a,o){fetch("https://".concat(y,"/createvideotask?worker=").concat(encodeURIComponent(a),"&customerName=").concat(t,"&roomName=").concat(e,"&phoneNumber=").concat(o)).then((function(e){return e.json()})).then((function(e){console.log("task data",e)}))}},{key:"roomJoined",value:function(e){var t=this;console.log("Joined as '"+this.state.identity+"'"),this.setState({activeRoom:e,localMediaAvailable:!0,hasJoinedRoom:!0}),this.onCreateTask(this.state.roomName,this.state.roomName,localStorage.worker,localStorage.number),this.refs.remoteMedia.querySelector("video")||this.attachLocalTracks(Array.from(e.localParticipant.tracks.values()),this.refs.remoteMedia),e.on("participantConnected",(function(e){console.log("Joining: '"+e.identity+"'"),e.on("trackSubscribed",(function(a){console.log(e.identity+"have added a track: "+a.kind),t.setState({showPreview:!1}),document.getElementById("remote-media").appendChild(a.attach())}))})),e.on("participantDisconnected",(function(e){console.log("Participant '"+e.identity+"' left the room"),t.onLeaveRoom()})),e.on("disconnected",(function(){console.log("Room disconnect."),t.state.previewTracks&&t.state.previewTracks.forEach((function(e){e.stop()})),t.detachParticipantTracks(e.localParticipant),e.participants.forEach(t.detachParticipantTracks),t.setState({activeRoom:null,hasJoinedRoom:!1,previewTracks:null,localMediaAvailable:!1,showPreview:!0}),j().then((function(e){var t=document.getElementById("local-media");"video"==e.kind&&t.appendChild(e.attach())}))}))}},{key:"onLeaveRoom",value:function(){this.state.activeRoom.disconnect(),document.getElementById("remote-media").innerHTML=""}},{key:"componentDidMount",value:function(){var e=this;fetch("https://".concat(y,"/flexvideotokenizer?Identity=").concat(this.state.identity)).then((function(e){return e.json()})).then((function(t){console.log("data:",t),e.setState({token:t.token,identity:t.identity,roomName:Date.now()}),j().then((function(e){var t=document.getElementById("local-media");"video"==e.kind&&t.appendChild(e.attach())})),window.addEventListener("beforeunload",(function(){return e.onLeaveRoom()})),window.addEventListener("pagehide",(function(){return e.onLeaveRoom}))}))}},{key:"render",value:function(){var e=this.state.hasJoinedRoom?Object(p.jsx)(u.a,{color:"danger",onClick:this.onLeaveRoom,children:"Hang Up"}):Object(p.jsx)("div",{children:Object(p.jsx)(u.a,{color:"success",onClick:this.joinRoom,children:"Start Video"})});return Object(p.jsx)("div",{children:Object(p.jsx)(v.a,{fluid:!0,children:Object(p.jsxs)(k.a,{style:{marginTop:25},xs:"2",children:[Object(p.jsxs)(f.a,{xs:"5",children:[this.state.showPreview?Object(p.jsx)("div",{className:"preview",children:Object(p.jsx)("div",{ref:"localMedia",id:"local-media"})}):null,Object(p.jsx)("div",{className:"remoteContainer",children:Object(p.jsx)("div",{ref:"remoteMedia",id:"remote-media"})})]}),Object(p.jsx)(f.a,{children:e})]})})})}}]),a}(o.Component);var b=function(){return Object(p.jsx)("div",{className:"App",children:Object(p.jsx)(g,{})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(p.jsx)(b,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},91:function(e,t,a){},92:function(e,t,a){}},[[207,1,2]]]);
//# sourceMappingURL=main.1da97da7.chunk.js.map