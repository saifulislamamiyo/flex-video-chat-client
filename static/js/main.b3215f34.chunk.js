(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{210:function(e,t,a){"use strict";a.r(t);var o=a(1),n=a.n(o),i=a(81),c=a.n(i),r=(a(94),a(95),a(96),a(82)),s=a(83),l=a(87),d=a(84),h=a(7),m=a(88),u=a(34),v=a.n(u),k=a(212),p=a(213),f=a(214),S=a(215),g=a(216),T=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this,e))).state={worker:"",token:"",identity:"",roomName:"",roomNameErr:!1,previewTracks:null,localMediaAvailable:!1,hasJoinedRoom:!1,activeRoom:null,screenTrack:null},a.joinRoom=a.joinRoom.bind(Object(h.a)(a)),a.handleRoomNameChange=a.handleRoomNameChange.bind(Object(h.a)(a)),a.roomJoined=a.roomJoined.bind(Object(h.a)(a)),a.onPreviewVideo=a.onPreviewVideo.bind(Object(h.a)(a)),a.onPreviewStop=a.onPreviewStop.bind(Object(h.a)(a)),a.onLeaveRoom=a.onLeaveRoom.bind(Object(h.a)(a)),a.onShareScreen=a.onShareScreen.bind(Object(h.a)(a)),a.onStopShareScreen=a.onStopShareScreen.bind(Object(h.a)(a)),a.detachParticipantTracks=a.detachParticipantTracks.bind(Object(h.a)(a)),a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"handleRoomNameChange",value:function(e){var t=e.target.value,a=e.target.value;this.setState({identity:t}),this.setState({roomName:a})}},{key:"joinRoom",value:function(){console.log("Joining room '"+this.state.roomName+"'...");var e={name:this.state.roomName};this.state.previewTracks&&(e.tracks=this.state.previewTracks),v.a.connect(this.state.token,e).then(this.roomJoined,function(e){alert("Could not connect to Twilio: "+e.message)})}},{key:"getScreenShare",value:function(){return navigator.getDisplayMedia?navigator.getDisplayMedia({video:!0}):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia({video:!0}):navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"}})}},{key:"attachTracks",value:function(e,t){e.forEach(function(e){t.appendChild(e.track.attach())})}},{key:"attachParticipantTracks",value:function(e,t){var a=Array.from(e.tracks.values());this.attachTracks(a,t)}},{key:"detachTracks",value:function(e){e.forEach(function(e){e.detach().forEach(function(e){e.remove()})})}},{key:"detachParticipantTracks",value:function(e){var t=Array.from(e.tracks.values()),a=this.refs.localMedia;a.querySelector("video")||this.detachParticipantTracks({tracks:t},a)}},{key:"onPreviewVideo",value:function(){var e=this;(this.state.previewTracks?Promise.resolve(this.state.previewTracks):v.a.createLocalTracks()).then(function(t){e.setState({previewTracks:t});var a=e.refs.localMedia;a.querySelector("video")||e.attachParticipantTracks({tracks:t},a)},function(e){console.error("Unable to access local media",e)})}},{key:"onPreviewStop",value:function(){this.detachTracks(this.state.previewTracks),this.setState({previewTracks:null})}},{key:"onShareScreen",value:function(){var e=this;this.getScreenShare().then(function(t){e.setState({screenTrack:t.getVideoTracks()[0]}),e.state.activeRoom.localParticipant.publishTrack(t.getVideoTracks()[0])})}},{key:"onStopShareScreen",value:function(){this.state.activeRoom.localParticipant.unpublishTrack(this.state.screenTrack),this.setState({screenTrack:null})}},{key:"onCreateTask",value:function(e,t,a,o){fetch("https://".concat("video-svc-5346-dev.twil.io","/createvideotask?worker=").concat(encodeURIComponent(a),"&customerName=").concat(t,"&roomName=").concat(e,"&phoneNumber=").concat(o)).then(function(e){return e.json()}).then(function(e){console.log("task data",e)})}},{key:"roomJoined",value:function(e){var t=this;console.log("Joined as '"+this.state.identity+"'"),this.setState({activeRoom:e,localMediaAvailable:!0,hasJoinedRoom:!0}),this.onCreateTask(this.state.roomName,this.state.roomName,localStorage.worker,localStorage.number);var a=this.refs.localMedia;a.querySelector("video")||this.attachParticipantTracks(e.localParticipant,a),a.querySelector("video")||this.attachParticipantTracks(e.localParticipant,a),e.participants.forEach(function(e){console.log("Already in Room: '"+e.identity+"'");var a=t.refs.remoteMedia;t.attachParticipantTracks(e,a)}),e.on("participantConnected",function(e){console.log("Joining: '"+e.identity+"'")}),e.on("trackPublished",function(e,a){console.log(a.identity+" added track: "+e.kind);var o=t.refs.remoteMedia;t.attachTracks([e],o)}),e.on("trackUnpublished",function(e,a){console.log(a.identity+" removed track: "+e.kind),t.detachTracks([e])}),e.on("participantDisconnected",function(e){console.log("Participant '"+e.identity+"' left the room"),t.detachParticipantTracks(e)}),e.on("disconnected",function(){t.state.previewTracks&&t.state.previewTracks.forEach(function(e){e.stop()}),t.detachParticipantTracks(e.localParticipant),e.participants.forEach(t.detachParticipantTracks),t.setState({activeRoom:null,hasJoinedRoom:!1,previewTracks:null,localMediaAvailable:!1})})}},{key:"onLeaveRoom",value:function(){this.state.activeRoom.disconnect()}},{key:"componentDidMount",value:function(){var e=this;fetch("https://".concat("video-svc-5346-dev.twil.io","/flexvideotokenizer?Identity=").concat(this.state.identity)).then(function(e){return e.json()}).then(function(t){console.log("data:",t),e.setState({token:t.token,identity:t.identity,roomName:Date.now()})})}},{key:"render",value:function(){var e,t=this.state.hasJoinedRoom?n.a.createElement(k.a,{color:"danger",onClick:this.onLeaveRoom},"Hang Up"):n.a.createElement("div",null,n.a.createElement(k.a,{color:"success",onClick:this.joinRoom},"Start Video"));return e=this.state.hasJoinedRoom&&!this.state.screenTrack?n.a.createElement(k.a,{color:"success",onClick:this.onShareScreen},"Share Screen"):this.state.hasJoinedRoom&&this.state.screenTrack?n.a.createElement(k.a,{color:"danger",onClick:this.onStopShareScreen},"Stop Sharing"):null,this.state.previewTracks&&!this.state.hasJoinedRoom?n.a.createElement(k.a,{onClick:this.onPreviewStop},"Stop Preview"):this.state.hasJoinedRoom?null:n.a.createElement(k.a,{onClick:this.onPreviewVideo},"Preview Video"),n.a.createElement("div",null,n.a.createElement(p.a,{style:{marginTop:10}},n.a.createElement(f.a,{md:"12"},n.a.createElement("div",{className:"remoteContainer",ref:"remoteMedia",id:"remote-media"}))),n.a.createElement(p.a,null,n.a.createElement(f.a,{md:"6",className:"text-center"},n.a.createElement("div",{className:"preview"},n.a.createElement("div",{ref:"localMedia"})))),n.a.createElement(S.a,null,n.a.createElement(p.a,null,n.a.createElement(f.a,{md:"4"},n.a.createElement("br",null),this.state.hasJoinedRoom?null:n.a.createElement(g.a,{value:this.state.identity?this.state.identity:"",placeholder:"Customer Name",onChange:this.handleRoomNameChange}),n.a.createElement("br",null),n.a.createElement(p.a,null,t,n.a.createElement("span",null,"\xa0"),e)))))}}]),t}(o.Component);var y=function(){return n.a.createElement("div",{className:"App"},n.a.createElement(T,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(n.a.createElement(y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},89:function(e,t,a){e.exports=a(210)},94:function(e,t,a){},95:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},96:function(e,t,a){}},[[89,1,2]]]);
//# sourceMappingURL=main.b3215f34.chunk.js.map