(this["webpackJsonpsite-video-chat-client"]=this["webpackJsonpsite-video-chat-client"]||[]).push([[0],{208:function(e,t,a){"use strict";a.r(t);var o=a(6),n=a(83),i=a.n(n),c=(a(92),a.p,a(93),a(84)),r=a(85),s=a(9),l=a(87),d=a(86),h=a(35),m=a.n(h),v=a(210),u=a(211),k=a(212),p=a(213),j=a(214),f=a(2),b="video-svc-5346-dev.twil.io",S=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(e){var o;return Object(c.a)(this,a),(o=t.call(this,e)).state={worker:"",token:"",identity:"",roomName:"",roomNameErr:!1,previewTracks:null,localMediaAvailable:!1,hasJoinedRoom:!1,activeRoom:null,screenTrack:null},o.joinRoom=o.joinRoom.bind(Object(s.a)(o)),o.handleRoomNameChange=o.handleRoomNameChange.bind(Object(s.a)(o)),o.roomJoined=o.roomJoined.bind(Object(s.a)(o)),o.onPreviewVideo=o.onPreviewVideo.bind(Object(s.a)(o)),o.onPreviewStop=o.onPreviewStop.bind(Object(s.a)(o)),o.onLeaveRoom=o.onLeaveRoom.bind(Object(s.a)(o)),o.onShareScreen=o.onShareScreen.bind(Object(s.a)(o)),o.onStopShareScreen=o.onStopShareScreen.bind(Object(s.a)(o)),o.detachParticipantTracks=o.detachParticipantTracks.bind(Object(s.a)(o)),o}return Object(r.a)(a,[{key:"handleRoomNameChange",value:function(e){var t=e.target.value,a=e.target.value;this.setState({identity:t}),this.setState({roomName:a})}},{key:"joinRoom",value:function(){console.log("Joining room '"+this.state.roomName+"'...");var e={name:this.state.roomName};this.state.previewTracks&&(e.tracks=this.state.previewTracks),m.a.connect(this.state.token,e).then(this.roomJoined,(function(e){alert("Could not connect to Twilio: "+e.message)}))}},{key:"getScreenShare",value:function(){return navigator.getDisplayMedia?navigator.getDisplayMedia({video:!0}):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia({video:!0}):navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"}})}},{key:"attachTracks",value:function(e,t){e.forEach((function(e){t.appendChild(e.track.attach())}))}},{key:"attachParticipantTracks",value:function(e,t){var a=Array.from(e.tracks.values());this.attachTracks(a,t)}},{key:"detachTracks",value:function(e){e.forEach((function(e){e.detach().forEach((function(e){e.remove()}))}))}},{key:"detachParticipantTracks",value:function(e){var t=Array.from(e.tracks.values()),a=this.refs.localMedia;a.querySelector("video")||this.detachParticipantTracks({tracks:t},a)}},{key:"onPreviewVideo",value:function(){var e=this;(this.state.previewTracks?Promise.resolve(this.state.previewTracks):m.a.createLocalTracks()).then((function(t){e.setState({previewTracks:t});var a=e.refs.localMedia;a.querySelector("video")||e.attachParticipantTracks({tracks:t},a)}),(function(e){console.error("Unable to access local media",e)}))}},{key:"onPreviewStop",value:function(){this.detachTracks(this.state.previewTracks),this.setState({previewTracks:null})}},{key:"onShareScreen",value:function(){var e=this;this.getScreenShare().then((function(t){e.setState({screenTrack:t.getVideoTracks()[0]}),e.state.activeRoom.localParticipant.publishTrack(t.getVideoTracks()[0])}))}},{key:"onStopShareScreen",value:function(){this.state.activeRoom.localParticipant.unpublishTrack(this.state.screenTrack),this.setState({screenTrack:null})}},{key:"onCreateTask",value:function(e,t,a,o){fetch("https://".concat(b,"/createvideotask?worker=").concat(encodeURIComponent(a),"&customerName=").concat(t,"&roomName=").concat(e,"&phoneNumber=").concat(o)).then((function(e){return e.json()})).then((function(e){console.log("task data",e)}))}},{key:"roomJoined",value:function(e){var t=this;console.log("Joined as '"+this.state.identity+"'"),this.setState({activeRoom:e,localMediaAvailable:!0,hasJoinedRoom:!0}),this.onCreateTask(this.state.roomName,this.state.roomName,localStorage.worker,localStorage.number);var a=this.refs.localMedia;a.querySelector("video")||this.attachParticipantTracks(e.localParticipant,a),a.querySelector("video")||this.attachParticipantTracks(e.localParticipant,a),e.participants.forEach((function(e){console.log("Already in Room: '"+e.identity+"'");var a=t.refs.remoteMedia;t.attachParticipantTracks(e,a)})),e.on("participantConnected",(function(e){console.log("Joining: '"+e.identity+"'"),e.on("trackSubscribed",(function(a){console.log(e.identity+"have added a track: "+a.kind);t.refs.remoteMedia;document.getElementById("remote-media").appendChild(a.attach())}))})),e.on("trackPublished",(function(e,a){console.log(a.identity+" added track: "+e.kind);var o=t.refs.remoteMedia;t.attachTracks([e],o)})),e.on("trackUnpublished",(function(e,a){console.log(a.identity+" removed track: "+e.kind),t.detachTracks([e])})),e.on("participantDisconnected",(function(e){console.log("Participant '"+e.identity+"' left the room"),t.detachParticipantTracks(e),document.getElementById("remote-media").innerHTML="",t.onLeaveRoom()})),e.on("disconnected",(function(){console.log("Room disconnect."),t.state.previewTracks&&t.state.previewTracks.forEach((function(e){e.stop()})),t.detachParticipantTracks(e.localParticipant),e.participants.forEach(t.detachParticipantTracks),t.setState({activeRoom:null,hasJoinedRoom:!1,previewTracks:null,localMediaAvailable:!1})}))}},{key:"onLeaveRoom",value:function(){this.state.activeRoom.disconnect(),document.getElementById("remote-media").innerHTML=""}},{key:"componentDidMount",value:function(){var e=this;fetch("https://".concat(b,"/flexvideotokenizer?Identity=").concat(this.state.identity)).then((function(e){return e.json()})).then((function(t){console.log("data:",t),e.setState({token:t.token,identity:t.identity,roomName:Date.now()})}))}},{key:"render",value:function(){var e=this.state.hasJoinedRoom?Object(f.jsx)(v.a,{color:"danger",onClick:this.onLeaveRoom,children:"Hang Up"}):Object(f.jsx)("div",{children:Object(f.jsx)(v.a,{color:"success",onClick:this.joinRoom,children:"Start Video"})});return this.state.hasJoinedRoom&&!this.state.screenTrack?Object(f.jsx)(v.a,{color:"success",onClick:this.onShareScreen,children:"Share Screen"}):this.state.hasJoinedRoom&&this.state.screenTrack?Object(f.jsx)(v.a,{color:"danger",onClick:this.onStopShareScreen,children:"Stop Sharing"}):null,this.state.previewTracks&&!this.state.hasJoinedRoom?Object(f.jsx)(v.a,{onClick:this.onPreviewStop,children:"Stop Preview"}):this.state.hasJoinedRoom?null:Object(f.jsx)(v.a,{onClick:this.onPreviewVideo,children:"Preview Video"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(u.a,{style:{marginTop:10},children:Object(f.jsx)(k.a,{md:"12",children:Object(f.jsx)("div",{className:"remoteContainer",ref:"remoteMedia",id:"remote-media"})})}),Object(f.jsx)(u.a,{children:Object(f.jsx)(k.a,{md:"6",className:"text-center",children:Object(f.jsx)("div",{className:"preview",children:Object(f.jsx)("div",{ref:"localMedia"})})})}),Object(f.jsx)(p.a,{children:Object(f.jsx)(u.a,{children:Object(f.jsxs)(k.a,{md:"4",children:[this.state.hasJoinedRoom?null:Object(f.jsx)(j.a,{value:this.state.identity?this.state.identity:"",placeholder:"Customer Name",onChange:this.handleRoomNameChange}),Object(f.jsx)("br",{}),Object(f.jsx)(u.a,{children:e})]})})})]})}}]),a}(o.Component);var g=function(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(S,{})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(f.jsx)(g,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},92:function(e,t,a){},93:function(e,t,a){}},[[208,1,2]]]);
//# sourceMappingURL=main.6c6f7fd0.chunk.js.map